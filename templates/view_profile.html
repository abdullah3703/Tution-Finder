{% extends "base.html" %}

{% block content %}
<style>
.profile-container {
    max-width: 900px;
    margin: auto;
}
.profile-card {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
}
.profile-header {
    background: linear-gradient(135deg, #4e73df, #1cc88a);
    color: #fff;
    padding: 30px;
    text-align: center;
}
.profile-header img {
    border: 4px solid #fff;
    border-radius: 50%;
    width: 130px;
    height: 130px;
    object-fit: cover;
}
.profile-body {
    background-color: var(--card-bg, #fff);
    color: var(--text-color, #000);
    padding: 20px;
}
.info-label {
    font-weight: bold;
    color: #6c757d;
}
.section-title {
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: 600;
    border-bottom: 1px solid #dee2e6;
    padding-bottom: 0.3rem;
}
.card-block {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}
.card-block h6 {
    font-weight: 600;
    margin-bottom: 10px;
}
.card-row {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
}
.card-col {
    flex: 1 1 45%;
    min-width: 240px;
}
.card-item {
    background: #f8f9fa;
    border-radius: 6px;
    padding: 12px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.03);
    margin-bottom: 10px;
}
.card-item p {
    margin: 3px 0;
    font-size: 0.9rem;
}
</style>

<div class="container py-4 profile-container">
    <div class="card profile-card">
        <!-- Header with Photo & Name -->
        <div class="profile-header">
            <img src="{{ url_for('static', filename='uploads/' + profile_user.profile_picture) if profile_user.profile_picture else url_for('static', filename='uploads/default.jpg') }}" 
            alt="Profile Picture"
            onerror="this.onerror=null; this.src='{{ url_for('static', filename='uploads/default.jpg') }}';">

            <h3 class="mt-3">{{ profile_user.username }}</h3>
            <p class="mb-0">{{ profile_user.role | capitalize }}</p>
            {% if current_user.id != profile_user.id %}
                <hr>
                <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#reportModal">
                    ðŸš© Report to Admin
                </button>
                
            {% endif %}
        </div>

        <!-- Profile Info -->
        <div class="profile-body">
            <!-- Shared info -->
            <div class="mb-3">
                <span class="info-label">Email:</span> {{ profile_user.email }}
            </div>
            <div class="mb-3">
                <span class="info-label">Phone:</span> {{ profile_user.phone_number or 'Not provided' }}
            </div>
            <div class="mb-3">
                <span class="info-label">Address:</span> {{ profile_user.address or 'Not provided' }}
            </div>

            {% if profile_user.role == 'tutor' %}
                <hr>
                <h5>Qualifications & Experience</h5>
                <p><strong>Education:</strong> {{ profile_user.education or 'N/A' }}</p>
                <p><strong>Subjects:</strong> {{ profile_user.subjects or 'N/A' }}</p>
                <p><strong>Preferred Classes:</strong> {{ profile_user.preferred_classes or 'N/A' }}</p>
                <p><strong>Salary Expectation:</strong> {{ profile_user.salary_expectation or 'N/A' }}</p>
                <p><strong>Experience:</strong> {{ profile_user.experience or 'N/A' }}</p>
                <p><strong>Available Days:</strong> {{ profile_user.available_days or 'N/A' }}</p>
            {% elif profile_user.role == 'guardian' %}
                <hr>
                <h5>Student Information</h5>
                <p><strong>Student Name:</strong> {{ profile_user.student_name or 'N/A' }}</p>
                <p><strong>Class:</strong> {{ profile_user.student_class or 'N/A' }}</p>
                <p><strong>School:</strong> {{ profile_user.student_school or 'N/A' }}</p>
                <p><strong>Subjects Needed:</strong> {{ profile_user.subjects or 'N/A' }}</p>
                <p><strong>Preferred Tutor Gender:</strong> {{ profile_user.preferred_gender or 'N/A' }}</p>
                <p><strong>Medium:</strong> {{ profile_user.medium or 'N/A' }}</p>
                <p><strong>Offered Salary:</strong> {{ profile_user.salary or 'Negotiable' }}</p>
            {% endif %}

            <hr>

            

            {% if profile_user.role == 'guardian' %}
                <hr>
                <h5 class="section-title">Active Tuition Requests</h5>
                {% if active_tutor_requests %}
                    <div class="card-row">
                        {% for tr in active_tutor_requests %}
                            <div class="card-col">
                                <div class="card-block">
                                    <h6>Request #{{ tr.id }}</h6>
                                    <p><strong>Subjects:</strong> {{ tr.subjects }}</p>
                                    <p><strong>Classes:</strong> {{ tr.student_classes }}</p>
                                    <p><strong>Preferred Days:</strong> {{ tr.preferred_days or 'N/A' }}</p>
                                    <p><strong>Salary:</strong> {{ tr.salary or 'N/A' }}</p>
                                    <p><strong>Status:</strong> {{ tr.status.capitalize() }}</p>
                                    <p><strong>Created At:</strong> {{ tr.created_at.strftime('%d-%m-%Y') }}</p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p><em>No active tuition requests.</em></p>
                {% endif %}
            {% endif %}

            <hr>
            <h5 class="section-title">Confirmed Tuitions</h5>
            {% if confirmed_tuitions %}
                <div class="card-row">
                    {% for tuition in confirmed_tuitions %}
                        <div class="card-col">
                            <div class="card-block">
                                <h6>Tuition #{{ tuition.id }}</h6>
                                <p><strong>Subjects:</strong> {{ tuition.subjects }}</p>
                                <p><strong>Classes:</strong> {{ tuition.student_classes or 'N/A' }}</p>
                                <p><strong>Preferred Days:</strong> {{ tuition.preferred_days or 'N/A' }}</p>
                                <p><strong>Address:</strong> {{ tuition.address or 'N/A' }}</p>
                                <p><strong>Start Time:</strong> {{ tuition.start_time.strftime('%d-%m-%Y %H:%M') if tuition.start_time else 'N/A' }}</p>
                                <p><strong>End Time:</strong> {{ tuition.end_time.strftime('%d-%m-%Y %H:%M') if tuition.end_time else 'N/A' }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p><em>No confirmed tuitions found.</em></p>
            {% endif %}

        </div>
    </div>
</div>

<!-- Report Modal (unchanged) -->
<div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('report_to_admin') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reportModalLabel">Report to Admin</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="reported_user_id" value="{{ profile_user.id }}">

          <div class="mb-3">
            <label class="form-label">Reason</label>
            <select class="form-select select2" name="report_type" required>
                <option value="">Select a reason</option>
                <option value="fake_profile">Fake Profile</option>
                <option value="spam">Spam</option>
                <option value="inappropriate">Inappropriate Content</option>
                <option value="other">Other</option>
                </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Description (optional)</label>
            <textarea class="form-control" name="description" rows="3"></textarea>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Submit Report</button>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
$(document).ready(function() {
    $('#reportModal').on('shown.bs.modal', function () {
        $('.select2').select2({
            dropdownParent: $('#reportModal'),
            width: '100%',
            placeholder: "Select a reason",
            allowClear: true
        });
    });
});
</script>

{% endblock %}
