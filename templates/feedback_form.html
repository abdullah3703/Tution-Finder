{% extends "base.html" %}

{% block content %}
<div class="container py-4" style="max-width: 600px;">
  <div class="card shadow-sm">

    <!-- =============================== -->
    <!-- Card Header -->
    <!-- =============================== -->
    <div class="card-header">
      Give Feedback to {{ receiver.username }}
    </div>

    <!-- =============================== -->
    <!-- Feedback Form -->
    <!-- =============================== -->
    <div class="card-body">
      <form method="POST">
        <!-- CSRF protection -->
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <!-- Rating selection -->
        <div class="mb-3">
          <label class="form-label">Rating</label>
          <select name="rating" class="form-select select2" required>
            <option value="">Select Rating</option>
            {% for i in range(1, 6) %}
              <option value="{{ i }}" {% if feedback and feedback.rating == i %}selected{% endif %}>
                {{ i }} Star{{ 's' if i > 1 else '' }}
              </option>
            {% endfor %}
          </select>
        </div>

        <!-- Feedback comment box -->
        <div class="mb-3">
          <label class="form-label">Feedback Comment</label>
          <textarea name="comment" class="form-control" rows="4">{{ feedback.comment if feedback else '' }}</textarea>
        </div>

        <!-- Submit + Cancel Buttons -->
        <button type="submit" class="btn btn-success">Submit Feedback</button>
        <a href="{{ url_for('view_profile', user_id=receiver.id) }}" class="btn btn-secondary">Cancel</a>
      </form>
    </div>
  </div>
</div>

<!-- =============================== -->
<!-- Select2 (for rating dropdown) -->
<!-- =============================== -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
  $(document).ready(function() {
    // Enhance rating dropdown with Select2 + Bootstrap 5 theme
    $('.select2').select2({
      theme: 'bootstrap-5',
      placeholder: "Select Rating",
      minimumResultsForSearch: Infinity // hide search box (not needed for 1-5 choices)
    });
  });
</script>
{% endblock %}
